<!-- lqr/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LQR: Inverted Pendulum Control</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    img {
      width: 100%;
      height: auto;
    }
    figure {
      margin: 30px 0;
    }
    figcaption {
      text-align: center;
      font-size: 0.9em;
      color: #555;
    }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h1>Linear Quadratic Regulator â€“ Inverted Pendulum on a Cart</h1>

  <p>This project explores the application of a Linear Quadratic Regulator (LQR) to stabilize an inverted pendulum mounted on a moving cart. The system is a classic example in control theory, representing a nonlinear, unstable system that requires continuous feedback to maintain balance.</p>

  <figure style="text-align: center;">
    <img src="inverted-pendulum-fbd.png" alt="Inverted Pendulum" style="width: 50%;" />
    <figcaption>Figure: Free-body diagram of the inverted pendulum system.</figcaption>
  </figure>

  <p>Using Newtonian mechanics, we derive the nonlinear equations of motion for the system and convert them into a linear state-space form around the upright equilibrium. These equations are then used in the design of an optimal controller using LQR.</p>

  <h2>System Equations</h2>

  <h3>Nonlinear Differential Equations</h3>
  <p>The equations of motion for the inverted pendulum on a cart are:</p>
  $$
  \ddot{x} = \frac{-m^2 L^2 g \cos(\theta) \sin(\theta) + mL^2 ( mL \omega^2 \sin(\theta) - dv ) + mL^2 u}{mL^2(M + m \sin^2(\theta))}
  $$
  $$
  \ddot{\theta} = \frac{(m + M) m g l \sin(\theta) - ml \cos(\theta) ( mL \omega^2 \sin(\theta) - dv ) + ml \cos(\theta) u}{mL^2 (M + m \sin(\theta))}
  $$

  <h3>State-Space Representation</h3>
  <p>We define the state vector as:</p>
  $$
  x = \begin{bmatrix} x_1 \\ x_2 \\ x_3 \\ x_4 \end{bmatrix} = \begin{bmatrix} X \\ \dot{X} \\ \theta \\ \dot{\theta} \end{bmatrix}, \quad \dot{x} = \begin{bmatrix} \dot{x}_1 \\ \dot{x}_2 \\ \dot{x}_3 \\ \dot{x}_4 \end{bmatrix}
  $$
  <p>Where:</p>
  <ul>
    <li>\( \dot{x}_1 = x_2 = f_1(x, u) \)</li>
    <li>\( \dot{x}_2 = f_2(x, u) \)</li>
    <li>\( \dot{x}_3 = x_4 = f_3(x, u) \)</li>
    <li>\( \dot{x}_4 = f_4(x, u) \)</li>
  </ul>

  <h3>Linearized Matrices</h3>
  <p>The linearized state-space matrices around the upright position are:</p>
  $$
  A = \begin{bmatrix}
  0 & 1 & 0 & 0 \\
  0 & \frac{-d}{M} & \frac{-mg}{M} & 0 \\
  0 & 0 & 0 & 1 \\
  0 & \frac{-d}{ML} & \frac{-(M + m)g}{ML} & 0
  \end{bmatrix}, \quad
  B = \begin{bmatrix}
  0 \\
  \frac{1}{M} \\
  0 \\
  \frac{1}{ML}
  \end{bmatrix}
  $$
  $$
  C = \begin{bmatrix} 1 & 0 & 0 & 0 \end{bmatrix}, \quad D = [0]
  $$
  $$
  x_0 = \begin{bmatrix} y_0 \\ 0 \\ 0 \\ 0 \end{bmatrix}, \quad u_0 = 0
  $$

  <h2>Cost Function and Feedback Control</h2>

  <p>The LQR approach calculates a feedback matrix \(K\) that drives the system toward stability while balancing performance and control effort. The controller minimizes a cost function defined as:</p>
  $$
  J = \sum_{k=0}^{N} \left( x^T Q x + u^T R u \right)
  $$

  <p>This equation assigns a penalty for two things: how far the system deviates from the desired state, and how much control effort is applied. The matrix \(Q\) penalizes state error, while \(R\) penalizes large control actions. By tuning these weights, different behavior can be emphasized, such as faster convergence or reduced force usage.</p>

  <figure style="text-align: center;">
    <img src="feedback-loop.PNG" alt="LQR Feedback Loop" style="width: 60%;" />
    <figcaption>Figure: The feedback loop shows how the system's state is measured and corrected using the LQR gain.</figcaption>
  </figure>

  <h2>Controller Design and Testing</h2>
  <p>Three LQR configurations were tested using different Q and R weightings:</p>
  <ul>
    <li><strong>Case 1:</strong> Identity matrix Q and low R. Smooth motion and moderate force. Reached the target in about 4 seconds.</li>
    <li><strong>Case 2:</strong> Higher weight on position tracking. Faster response (around 2 seconds) but required more control effort.</li>
    <li><strong>Case 3:</strong> Increased R. Control effort was reduced, but the cart did not reach the desired position in time.</li>
  </ul>

  <figure>
    <img src="/assets/images/lqr-case1.png" alt="LQR Case 1 Simulation" />
    <figcaption>Case 1: Balanced motion with standard Q and low R.</figcaption>
  </figure>
  <figure>
    <img src="/assets/images/lqr-case2.png" alt="LQR Case 2 Simulation" />
    <figcaption>Case 2: Faster performance due to aggressive Q tuning.</figcaption>
  </figure>
  <figure>
    <img src="/assets/images/lqr-case3.png" alt="LQR Case 3 Simulation" />
    <figcaption>Case 3: Energy-efficient but underperforming response.</figcaption>
  </figure>

  <h2>Conclusion</h2>
  <p>The LQR controller successfully stabilized the inverted pendulum. By carefully selecting the Q and R matrices, the controller can be tailored to emphasize rapid correction, smoother behavior, or energy conservation depending on the needs of the system.</p>

</body>
</html>
